Firebase ã® **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆFirestoreï¼‰** ã¨ **èªè¨¼ï¼ˆAuthenticationï¼‰** ã‚’ **Next.jsï¼ˆTypeScriptã€Reactï¼‰** ã«çµ±åˆã™ã‚‹æ–¹æ³•ã‚’ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ”§ å‰æç’°å¢ƒ

* Node.jsï¼ˆv16ä»¥ä¸Šï¼‰
* Next.jsï¼ˆ13 ä»¥é™æ¨å¥¨ï¼‰
* TypeScript
* Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆä½œæˆæ¸ˆã¿ï¼‰

---

## ğŸ§± 1. Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã¨è¨­å®š

1. [Firebase ã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://console.firebase.google.com/)ã§æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2. ã€ŒWeb ã‚¢ãƒ—ãƒªã‚’è¿½åŠ ã€ã‹ã‚‰ Web ç”¨ã‚¢ãƒ—ãƒªç™»éŒ²
3. `firebaseConfig` ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§æ§ãˆã¦ãŠã

---

## ğŸ“¦ 2. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install firebase
```

---

## ğŸ“ 3. Firebase åˆæœŸåŒ–ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

`lib/firebase.ts`

```ts
// lib/firebase.ts
import { initializeApp, getApps, getApp } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY!,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN!,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID!,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET!,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID!,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID!,
};

const app = !getApps().length ? initializeApp(firebaseConfig) : getApp();

const auth = getAuth(app);
const db = getFirestore(app);

export { auth, db };
```

`.env.local` ã«ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ :

```
NEXT_PUBLIC_FIREBASE_API_KEY=your_api_key
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your_project.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
NEXT_PUBLIC_FIREBASE_APP_ID=your_app_id
```

---

## ğŸ” 4. Firebase èªè¨¼æ©Ÿèƒ½ã®è¿½åŠ ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ï¼ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰

ä¾‹ï¼šEmail/Password èªè¨¼ï¼ˆGoogleèªè¨¼ã‚‚å¯èƒ½ï¼‰

### `hooks/useAuth.ts`ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼‰

```ts
import { useEffect, useState } from 'react';
import { auth } from '../lib/firebase';
import {
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut,
  onAuthStateChanged,
  User,
} from 'firebase/auth';

export function useAuth() {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, (firebaseUser) => {
      setUser(firebaseUser);
      setLoading(false);
    });
    return () => unsubscribe();
  }, []);

  const signup = (email: string, password: string) =>
    createUserWithEmailAndPassword(auth, email, password);

  const login = (email: string, password: string) =>
    signInWithEmailAndPassword(auth, email, password);

  const logout = () => signOut(auth);

  return { user, loading, login, signup, logout };
}
```

---

## ğŸ§ª 5. èªè¨¼ã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¾‹

### `pages/login.tsx`

```tsx
import { useState } from 'react';
import { useAuth } from '../hooks/useAuth';
import { useRouter } from 'next/router';

export default function LoginPage() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const { login, user } = useAuth();
  const router = useRouter();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await login(email, password);
      router.push('/dashboard');
    } catch (err) {
      alert('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input type="email" onChange={(e) => setEmail(e.target.value)} placeholder="Email" />
      <input type="password" onChange={(e) => setPassword(e.target.value)} placeholder="Password" />
      <button type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </form>
  );
}
```

---

## ğŸ”¥ 6. Firestoreï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ã¨ã®é€£æº

### ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ãƒ»å–å¾—ã‚µãƒ³ãƒ—ãƒ«

```ts
// Firestore ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ 
import { collection, addDoc, getDocs } from 'firebase/firestore';
import { db } from '../lib/firebase';

// ãƒ‡ãƒ¼ã‚¿è¿½åŠ 
await addDoc(collection(db, 'tasks'), {
  title: 'New Task',
  createdAt: new Date(),
});

// ãƒ‡ãƒ¼ã‚¿å–å¾—
const querySnapshot = await getDocs(collection(db, 'tasks'));
querySnapshot.forEach((doc) => {
  console.log(doc.id, doc.data());
});
```

---

## ğŸ§­ 7. èªè¨¼ã‚¬ãƒ¼ãƒ‰ï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¿…é ˆãƒšãƒ¼ã‚¸ï¼‰

```tsx
// components/AuthGuard.tsx
import { useAuth } from '../hooks/useAuth';
import { useRouter } from 'next/router';
import { useEffect } from 'react';

export default function AuthGuard({ children }: { children: React.ReactNode }) {
  const { user, loading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!loading && !user) {
      router.push('/login');
    }
  }, [user, loading]);

  if (loading || !user) return <p>Loading...</p>;
  return <>{children}</>;
}
```

ä½¿ã„æ–¹ï¼š

```tsx
// pages/dashboard.tsx
import AuthGuard from '../components/AuthGuard';

export default function DashboardPage() {
  return (
    <AuthGuard>
      <h1>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ¸ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿è¡¨ç¤ºï¼‰</h1>
    </AuthGuard>
  );
}
```

---

## âœ… ã¾ã¨ã‚

| æ©Ÿèƒ½                 | å®Ÿè£…æ¸ˆ |
| ------------------ | --- |
| Firebase èªè¨¼        | âœ…   |
| Firestore ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ»å–å¾— | âœ…   |
| èªè¨¼ã‚¬ãƒ¼ãƒ‰              | âœ…   |
| TypeScript å¯¾å¿œ      | âœ…   |

---

## ğŸ“Œ è£œè¶³

* Googleèªè¨¼ãªã©ã®ä»–ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ã«ã‚‚ç°¡å˜ã«å¯¾å¿œã§ãã¾ã™ã€‚
* Firestore ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã¯å¿˜ã‚Œãšã«è¨­å®šã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š`request.auth != null` ãªã©ï¼‰ã€‚
* SSR ã‚„ Server Actionsï¼ˆNext.js 14ä»¥é™ï¼‰ã¨ã®çµ±åˆã‚‚å¯èƒ½ã§ã™ã€‚

---

ã‚‚ã—ã€ŒGoogle èªè¨¼ã‚’ä½¿ã„ãŸã„ã€ã€ŒSSRã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’èªè­˜ã—ãŸã„ã€ã€ŒCloud Functions ã¨çµ„ã¿åˆã‚ã›ãŸã„ã€ãªã©ã€ç‰¹å®šã®è¦æœ›ãŒã‚ã‚Œã°ã€ãã“ã«ç‰¹åŒ–ã—ã¦è©³ã—ãè§£èª¬ã§ãã¾ã™ï¼

å¿…è¦ã§ã‚ã‚Œã°ãã®ã¾ã¾ç¶šã‘ã¦ãã ã•ã„ ğŸ™Œ
