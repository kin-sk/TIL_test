æœ¬ç•ªã€é–‹ç™ºã®Dockerfile
ã“ã“ã§ã¯ **Spring Boot (backend)** ã¨ **Next.js (frontend)** ã®ä¸¡æ–¹ã«å¯¾ã—ã¦ï¼š

---

# âœ… **é–‹ç™ºç”¨ / æœ¬ç•ªç”¨ Dockerfile åˆ†é›¢ã‚µãƒ³ãƒ—ãƒ« & ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰**

---

## ğŸŸ¡ **Spring Boot (Backend)**

### ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆä¾‹ï¼‰

```
backend/
â”œâ”€â”€ dev.Dockerfile
â”œâ”€â”€ prod.Dockerfile
â”œâ”€â”€ mvnw
â”œâ”€â”€ pom.xml
â””â”€â”€ src/
```

---

### ğŸ”§ `dev.Dockerfile`ï¼ˆé–‹ç™ºç”¨ï¼‰

```Dockerfile
FROM openjdk:17-jdk-slim

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
WORKDIR /app

# Gitãªã©ã®é–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
RUN apt-get update && apt-get install -y git && rm -rf /var/lib/apt/lists/*

# Mavenã®ãƒ©ãƒƒãƒ‘ãƒ¼ã¨ä¾å­˜å®šç¾©ã‚’å…ˆã«ã‚³ãƒ”ãƒ¼ï¼ˆä¾å­˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
COPY .mvn/ .mvn
COPY mvnw pom.xml ./
RUN chmod +x mvnw && ./mvnw dependency:go-offline

# æ®‹ã‚Šã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
COPY src ./src

# EXPOSE ãƒãƒ¼ãƒˆï¼ˆé–‹ç™ºã§ä½¿ã†å ´åˆï¼‰
EXPOSE 8080

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒãƒ³ãƒ‰ï¼ˆæ‰‹å‹•èµ·å‹•å‰æãªã‚‰ sleepï¼‰
CMD ["sleep", "infinity"]
```

---

### ğŸ“¦ `prod.Dockerfile`ï¼ˆæœ¬ç•ªç”¨ / ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ï¼‰

```Dockerfile
# --- Build Stage ---
FROM maven:3.9.6-eclipse-temurin-17 as builder
WORKDIR /build
COPY .mvn/ .mvn
COPY mvnw pom.xml ./
RUN chmod +x mvnw && ./mvnw dependency:go-offline
COPY src ./src
RUN ./mvnw clean package -DskipTests

# --- Runtime Stage ---
FROM eclipse-temurin:17-jdk-alpine
WORKDIR /app
COPY --from=builder /build/target/*.jar ./app.jar

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app/app.jar"]
```

---

## ğŸ”µ **Next.js (Frontend)**

### ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆä¾‹ï¼‰

```
frontend/
â”œâ”€â”€ dev.Dockerfile
â”œâ”€â”€ prod.Dockerfile
â”œâ”€â”€ package.json
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
```

---

### ğŸ”§ `dev.Dockerfile`ï¼ˆé–‹ç™ºç”¨ï¼‰

```Dockerfile
FROM node:18-alpine

WORKDIR /app

# é–‹ç™ºã«å¿…è¦ãªãƒ„ãƒ¼ãƒ«
RUN apk add --no-cache git

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY package.json package-lock.json ./
RUN npm install

# ã‚¢ãƒ—ãƒªã®ã‚³ãƒ”ãƒ¼
COPY . .

EXPOSE 3000

CMD ["npm", "run", "dev"]
```

---

### ğŸ“¦ `prod.Dockerfile`ï¼ˆæœ¬ç•ªç”¨ / ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ï¼‰

```Dockerfile
# --- Build Stage ---
FROM node:18-alpine as builder
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm install
COPY . .
RUN npm run build

# --- Runtime Stage ---
FROM node:18-alpine
WORKDIR /app
COPY --from=builder /app/.next .next
COPY --from=builder /app/public public
COPY --from=builder /app/package.json ./
COPY --from=builder /app/node_modules node_modules
COPY --from=builder /app/next.config.js ./

ENV NODE_ENV=production
EXPOSE 3000
CMD ["npm", "start"]
```

---

## âœ… `docker-compose.yml` å´ã§æŒ‡å®šã®åˆ‡æ›¿ä¾‹ï¼ˆdev/prodï¼‰

```yaml
services:
  backend:
    build:
      context: ./backend
      dockerfile: dev.Dockerfile  # â† æœ¬ç•ªæ™‚ã¯ prod.Dockerfile ã«å¤‰æ›´
    ports:
      - "8080:8080"

  frontend:
    build:
      context: ./frontend
      dockerfile: dev.Dockerfile  # â† æœ¬ç•ªæ™‚ã¯ prod.Dockerfile ã«å¤‰æ›´
    ports:
      - "3000:3000"
```

---

## âœ… ãŠã¾ã‘ï¼š`.dockerignore` ã‚’ç”¨æ„ã—ã‚ˆã†

`backend/.dockerignore` ä¾‹ï¼š

```
target/
.idea/
*.iml
*.log
```

`frontend/.dockerignore` ä¾‹ï¼š

```
node_modules/
.next/
*.log
```

---

## ğŸ’¬ ã”å¸Œæœ›ãŒã‚ã‚Œã°

* `Makefile` ã‚„ `build.sh` ã‚’ä½¿ã£ãŸé–‹ç™º/æœ¬ç•ªåˆ‡ã‚Šæ›¿ãˆè‡ªå‹•åŒ–
* GitHub Actions ãªã©ã§ CI å¯¾å¿œã—ãŸãƒ“ãƒ«ãƒ‰

ãªã©ã‚‚è¿½åŠ ã§ãã¾ã™ï¼å¿…è¦ã«å¿œã˜ã¦ãŠæ°—è»½ã«ã©ã†ãã€‚
