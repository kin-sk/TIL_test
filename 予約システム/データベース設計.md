### Firebase Firestore データベース設計

この設計は、NoSQLデータベースであるFirestoreの特性を活かし、アプリケーションからのデータ取得が効率的に行えるように考慮されています。

#### 1. `shopSettings` (医院設定)

医院全体の基本情報や予約システムの動作設定を格納するコレクションです。ドキュメントは一つだけ作成し、IDを`main`などに固定して運用します。

*   **コレクション名:** `shopSettings`
*   **ドキュメントIDの例:** `main`

| フィールド名 | 型 | 説明 | 例 |
| :--- | :--- | :--- | :--- |
| `shopName` | `string` | 医院名 | `"Next.js歯科"` |
| `address` | `string` | 住所 | `"東京都千代田区1-1-1"` |
| `phoneNumber` | `string` | 電話番号 | `"03-1234-5678"` |
| `openingHours` | `array` | 曜日ごとの診療時間 | `[{day: 1, start: '09:30', end: '18:30'}, ...]` ※ `day`は曜日を表す数値（例: 日=0, 月=1） |
| `holidays` | `array` | 特定の休診日（祝日、年末年始など） | `['2024-12-29', '2024-12-30', ...]` ※ `YYYY-MM-DD`形式 |
| `bookingInterval` | `number` | 予約を受け付ける時間間隔（分） | `30`（30分ごと） |
| `bookingLeadTime` | `number` | 何日前から予約可能か（日数） | `90`（90日前から） |

---

#### 2. `menus` (治療メニュー)

提供する治療やサービス（クリーニング、検診、ホワイトニングなど）の情報を格納するコレクションです。

*   **コレクション名:** `menus`
*   **ドキュメントIDの例:** 自動生成ID (`25wGz...`)

| フィールド名 | 型 | 説明 | 例 |
| :--- | :--- | :--- | :--- |
| `name` | `string` | メニュー名 | `"定期検診・クリーニング"` |
| `description` | `string` | メニューの詳細な説明 | `"歯石の除去、着色汚れの除去、フッ素塗布などを行います。"` |
| `price` | `number` | 価格（円）※保険適用外の場合など | `5000` |
| `duration` | `number` | 目安の所要時間（分） | `60` |
| `isActive` | `boolean` | 予約画面に表示するかどうかのフラグ | `true` |
| `order` | `number` | メニュー一覧での表示順を制御する数値 | `10` |

---

#### 3. `users` (患者情報)

会員登録機能を利用する患者の情報を格納するコレクションです。Firebase Authenticationでユーザー登録した際のUID（ユニークID）をドキュメントIDとして利用します。

*   **コレクション名:** `users`
*   **ドキュメントIDの例:** Firebase AuthenticationのUID (`abcde...`)

| フィールド名 | 型 | 説明 | 例 |
| :--- | :--- | :--- | :--- |
| `email` | `string` | メールアドレス（ログインID） | `"test@example.com"` |
| `name` | `string` | 氏名 | `"山田 太郎"` |
| `nameKana` | `string` | 氏名（フリガナ） | `"ヤマダ タロウ"` |
| `phoneNumber` | `string` | 電話番号 | `"090-1111-2222"` |
| `createdAt` | `timestamp` | アカウント作成日時 | `2023-10-27T10:00:00Z` |

---

#### 4. `bookings` (予約情報)

このシステムで最も重要な、個々の予約データを格納するコレクションです。

*   **コレクション名:** `bookings`
*   **ドキュメントIDの例:** 自動生成ID (`xyz123...`)

| フィールド名 | 型 | 説明 | 例 |
| :--- | :--- | :--- | :--- |
| `startTime` | `timestamp` | **予約開始日時。**　カレンダー表示や空き状況確認の検索で最も重要になります。 | `2024-11-15T10:30:00Z` |
| `endTime` | `timestamp` | 予約終了日時。`startTime` + `menus.duration` で計算して格納します。 | `2024-11-15T11:30:00Z` |
| `menuId` | `string` | 予約されたメニューのID (`menus`コレクションへの参照) | `"25wGz..."` |
| `menuName` | `string` | 予約されたメニューの名前。表示の際に`menus`を都度参照しなくて済むように、あえて重複して保持します。 | `"定期検診・クリーニング"` |
| `userId` | `string` or `null` | 予約した患者のID (`users`コレクションへの参照)。非会員予約の場合は `null`。 | `"abcde..."` |
| `customerInfo` | `map` | 予約者情報。会員・非会員問わず、予約時点での情報を格納します。 | `{name: "山田 太郎", nameKana: "ヤマダ タロウ", email: "test@example.com", phone: "090-1111-2222"}` |
| `needsPickup` | `boolean` | **送迎希望の有無。** `true`なら送迎希望あり、`false`なら希望なし。 | `true` |
| `status` | `string` | 予約の状態。 | `"confirmed"` (確定), `"cancelled"` (キャンセル済) など |
| `createdAt` | `timestamp` | 予約データが作成された日時。 | `2024-10-27T15:20:00Z` |

---